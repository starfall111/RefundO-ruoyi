<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.refund.root.mapper.RfScanRecordsMapper">
    
    <resultMap type="RfScanRecords" id="RfScanRecordsResult">
        <result property="scanId"    column="scan_id"    />
        <result property="scanTime"    column="scan_time"    />
        <result property="isOffline"    column="is_offline"    />
        <result property="userId"    column="user_id"    />
        <result property="productId"    column="product_id"    />
        <result property="refundStatus"    column="refund_status"    />
        <result property="scanNumber"    column="scan_number"    />
        <result property="value"    column="value"    />
        <result property="refundRatio"    column="refund_ratio"    />
        <result property="originalPrice"    column="original_price"    />
    </resultMap>

    <sql id="selectRfScanRecordsVo">
        select scan_id, scan_time, is_offline, user_id, rf_scan_records.product_id, refund_status, scan_number, rf_products.value, rf_products.refund_ratio, rf_products.original_price from rf_scan_records join rf_products on rf_scan_records.product_id = rf_products.product_id
    </sql>

    <select id="selectRfScanRecordsList" parameterType="RfScanRecords" resultMap="RfScanRecordsResult">
        <include refid="selectRfScanRecordsVo"/>
        <where>  
            <if test="scanTime != null "> and scan_time = #{scanTime}</if>
            <if test="userId != null "> and user_id = #{userId}</if>
            <if test="productId != null "> and product_id = #{productId}</if>
            <if test="refundStatus != null "> and refund_status = #{refundStatus}</if>
            <if test="scanNumber != null  and scanNumber != ''"> and scan_number = #{scanNumber}</if>
        </where>
    </select>
    
    <select id="selectRfScanRecordsByScanId" parameterType="Long" resultMap="RfScanRecordsResult">
        <include refid="selectRfScanRecordsVo"/>
        where scan_id = #{scanId}
    </select>

    <insert id="insertRfScanRecords" parameterType="RfScanRecords" useGeneratedKeys="true" keyProperty="scanId">
        insert into rf_scan_records
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="scanTime != null">scan_time,</if>
            <if test="isOffline != null">is_offline,</if>
            <if test="userId != null">user_id,</if>
            <if test="productId != null">product_id,</if>
            <if test="refundStatus != null">refund_status,</if>
            <if test="scanNumber != null">scan_number,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="scanTime != null">#{scanTime},</if>
            <if test="isOffline != null">#{isOffline},</if>
            <if test="userId != null">#{userId},</if>
            <if test="productId != null">#{productId},</if>
            <if test="refundStatus != null">#{refundStatus},</if>
            <if test="scanNumber != null">#{scanNumber},</if>
         </trim>
    </insert>

    <update id="updateRfScanRecords" parameterType="RfScanRecords">
        update rf_scan_records
        <trim prefix="SET" suffixOverrides=",">
            <if test="scanTime != null">scan_time = #{scanTime},</if>
            <if test="isOffline != null">is_offline = #{isOffline},</if>
            <if test="userId != null">user_id = #{userId},</if>
            <if test="productId != null">product_id = #{productId},</if>
            <if test="refundStatus != null">refund_status = #{refundStatus},</if>
            <if test="scanNumber != null">scan_number = #{scanNumber},</if>
        </trim>
        where scan_id = #{scanId}
    </update>

    <delete id="deleteRfScanRecordsByScanId" parameterType="Long">
        delete from rf_scan_records where scan_id = #{scanId}
    </delete>

    <delete id="deleteRfScanRecordsByScanIds" parameterType="String">
        delete from rf_scan_records where scan_id in 
        <foreach item="scanId" collection="array" open="(" separator="," close=")">
            #{scanId}
        </foreach>
    </delete>
</mapper>